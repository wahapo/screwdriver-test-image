shared:
    environment:
        DOCKER_REPO: wahapo/screwdriver-test

jobs:
    docker-publish:
        requires: ~commit
        template: sd/dind@latest
        steps:
            - init: |
                date -u +"%Y%m%d-%H%M%S" > VERSION
                docker login --username $DOCKER_REGISTRY_USER --password $DOCKER_REGISTRY_TOKEN
            - build: |
                docker buildx build --platform linux/amd64,linux/arm64 --push -t $DOCKER_REPO:latest .
            - publish: |
                echo "skip"
